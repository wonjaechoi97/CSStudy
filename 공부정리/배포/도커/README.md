# Chap 1. 도커란 무엇인가?

### 도커란 무엇인가?

- **도커(Docker)**란 ***데이터 또는 프로그램을 격리시키는 기능***을 제공하는 소프트웨어
    - 주로 서버에서 사용한다.
    - MySQL, 아파치 등 여러 프로그램(소프트웨어)과 데이터를 각각 독립된 환경에 운영체제(비슷한 것) 통째로 격리하는 기능
    - 서버 상의 환경을 조립형 창고와 같은 작은 방으로 분할하여 독립된 창고에 데이터나 프로그램을 두는 것으로 이 창고를 **컨테이너**라고 하고, 이 컨테이너를 다루는 기능을 도커가 제공한다.
    - 도커를 사용하기 위해서는 도커 소프트웨어 본체인 **도커 엔진(Docker Engine)**을 설치해야 하고, 도커 엔진을 사용해서 컨테이너를 생성하고 구동할 수 있다.
- 컨테이너 생성을 위해서는 **이미지**가 필요
    - 컨테이너를 생성하기 위해서는 도커 엔진 외에 컨테이너의 빵틀과도 같은 역할을 수행하는 **이미지**가 필요하다.
    - 이미지는 종류가 많다. 아파치 컨테이너를 만들기 위해서는 아파치 이미지, MySQL컨테이너를 만들기 위해서는 MySQL 이미지가 필요하다.
    - 용량 내에서 여러 개의 컨테이너를 만들 수 있다.
- 도커는 **리눅스** 운영체제에서 사용되어야 한다.
    - 윈도우에서도 도커를 구동 가능하지만 내부적으로는 리눅스가 사용된다.
    - 컨테이너에서 동작시킬 프로그램도 **리눅스용 프로그램**이다.

![docker-apps-1024x709.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/4e3dbb76-079d-448f-a87a-4a74b4fede86/docker-apps-1024x709.png)

### 데이터나 프로그램을 독립된 환경에 격리해야 하는 이유

- 소프트웨어는 단일 프로그램이 아니라 여러 개의 프로그램으로 구성된 경우가 많다.
    - 예) 워드프로세스는 MySQL 데이터베이스를 따로 갖추지 않으면 사용할 수 없다.
- 다른 프로그램과 특정 폴더나 디렉토리를 공유하거나 같은 경로에 설정 정보를 저장하는 경우도 있다.
    - 이로 인해 프로그램 하나를 업데이트하면 다른 프로그램에게도 영향을 미친다.
    - 예) **시스템 A**가 **프로그램 P**가 **5.0버전**이어야만 동작하도록 만들어졌는데 **시스템 B**만을 위해 **프로그램 P**를 **8.0 버전**으로 업데이트 하면 **시스템 A**가 동작하지 않을 것
    - 공유 프로그램의 경우 외에도 실행 환경, 설정 파일, 라이브러리 등의 변경에서도 같은 문제가 발생 가능
    - 설정 충돌!!
- 설계 시 문제가 없었던 프로그램 끼리도 실제로 설치하면 오류 일으킬 수도 있다.
    - **주로 대부분 프로그램 간 공유가 원인이다.**
    - 서버에서는 여러 프로그램이 함께 동작하므로 처음 구축할 때부터 신중하게 따져 보아야 한다.
- 프로그램에 따라 한 서버에 한 버전밖에 설치할 수 없는 경우도 있다.

### 프로그램의 격리란?

- 컨테이너 안의 프로그램은 다른 프로그램과 격리된 상태가 된다.
- 격리하면 여러 프로그램이 한 서버에서 실행되며 발생하는 문제를 대부분 해결할 수 있다.

![가로회전.jpg](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/f55b1550-1b94-4ce0-88a3-c407f944cb9f/%EA%B0%80%EB%A1%9C%ED%9A%8C%EC%A0%84.jpg)

- 일반적으로 한 서버에 하나의 버전만 설치 가능한 경우가 대부분
- 도커 컨테이너는 완전 독립된 환경이므로 여러 컨테이너에서 같은 프로그램을 실행할 수 있고 버전이 달라도 상관없다.

## 서버와 도커

### 서버의 두 가지 의미

- 서버란 **어떤 서비스를 제공하는 것**
- **기능적 의미의 서버**
    - 웹 기능을 제공하는 서버, 메일 기능을 제공하는 서버
    - 서버의 기능은 소프트웨어가 제공하므로 소프트웨어를 설치하면 서버의 기능을 갖게 된다.
- **물리적 컴퓨터로서의 서버**
    - 데스크톱 컴퓨터와 같이 물리적으로 존재하는 컴퓨터
- 구분하는 이유는 물리적 컴퓨터로서의 서버에 여러 기능적 의미의 서버를 둘 수 있기 때문
    - 여러 가지 소프트웨어를 한 컴퓨터에 설치할 수도 있다.
    - 웹 서버와 메일 서버, FTP 서버를 한 컴퓨터에서 제공하는 경우 흔하다.
    - 시스템 서버와 데이터베이스 서버가 함께 동작하는 경우도 있다.

### 컨테이너를 이용해 여러 서버 기능을 함께 실행

- 컨테이너 기술을 활요해 프로그램을 격리하여 한 대의 서버에서 여러 종류 혹은 여러 개의 서버를 올릴 수 있다.
- 한 대의 서버에서 여러 서버를 올릴 수 있으면 물리 서버를 줄일 수 있어 비용이 감소한다.
- 컨테이너 기술 없이 한 서버에 여러 서버를 올린다면 A 프로젝트 개발자가 B 프로젝트를 건드릴 리스크가 존재한다.

### 컨테이너는 자유롭게 옮길 수 있다

- 컨테이너 정보를 내보내기 한 다음에 다른 도커 엔진에서 복원하는 형태로 컨테이너를 옮길 수 있다.
- 이런 특성을 이용하여 팀원 전원에게 배포해 모두가 동일한 개발환경을 사용할 수 있다.
    - 도커만 설치되어 있다면 운영체제가 달라도 이를 신경 쓰지 않고 컨테이너를 옮길 수 있다.
- **물리적 환경 차이, 서버 구성의 차이를 무시 가능**
    - 운영 서버와 개발 서버의 환경 차이로 인한 문제 원천적으로 차단

# Chap 2. 도커의 동작 원리

## Section 01 도커의 동작 원리

### 도커의 구조

- 도커를 사용하는 경우 **운영체제 위에 도커 엔진이 동작하고 그 위에서 컨테이너가 동작**한다.
- 텅 빈 컨테이너를 사용할 일은 거의 없다.
- **모든 컨테이너에는 리눅스 운영체제 비슷한 무언가가 들어 있다.**
- **도커 엔진 아래에도 리눅스 운영체제가 있고, 컨테이너 속에 또 리눅스 운영체제 비슷한 것이 있다.**
- 운영체제는 커널 + 그 외의 주변 부분이다.
    - 주변 부분은 프로그램에서 명령을 전달 받거나 커널이 실행한  결과를 다시 프로그램에 전달하는 역할을 수행한다.
    - 주변 부분과 커널을 합친 패키지가 배포판이다.
        - 레드햇
        - centos
    - 도커에서 컨테이너가 완전히 분리되어 있어 밑바탕이 되는 리눅스 운영체제의 주변 부분이 컨테이너 속 프로그램의 명령을 전달받을 수 없다.
        - 컨테이너 속에 운영체제의 주변 부분이 들어 있어 프로그램의 명령어를 전달 받고 이를 커널에 전달하는 구조

![KakaoTalk_20220904_170803711.jpg](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/4c6af3af-4e9c-493f-b43b-4b1598e8433b/KakaoTalk_20220904_170803711.jpg)

- 비슷한 것의 의미는 커널을 제외한 부분이 들어 있다는 뜻이다.
- 커널은 서버의 운영체제의 것을 빌려 쓸 수 있기 때문에 도커의 가벼움을 유지할 수 있다.

### 도커는 기본적으로 ‘리눅스용’이다.

- 도커는 **리눅스 운영체제가 동작하는것을 전제**로 하는 구조로 **리눅스 운영체제에서만 동작할 수** 있다.
- 컨테이너 내의 프로그램도 리눅스용 프로그램이다.
- 도커는 리눅스용이지만 윈도우나 macOS 운영체제 컴퓨터에서도 사용할 수 있다.
    1. VirtualBox or VMware 같은 가상 환경 위에 리눅스 운영체제를 설치하고 그 위에 도커를 실행하거나
    2. 윈도우 or macOS용 도커 데스크톱 처럼 도커를 실행하는 데 필요한 리눅스 운영체제를 포함하는 패키지를 설치해 사용한다. 
    - 윈도우나 macOS 위에 리눅스 운영체제를 끌어들여 도커를 실행하는 것
    - 어떤 형태로든 리눅스 운영체제를 갖추어야 한다.

## Section 02 도커 허브와 이미지, 그리고 컨테이너

### 이미지와 컨테이너

- 이미지는 도커 컨테이너를 찍어내는 ‘빵틀’같은 것으로 컨테이너의 설계도이다.
    - 장난감을 찍어내는 금형과 같다.
- 이미지는 컨테이너를 만드는 데 사용된다.
    - 금형과 같으므로 하나만 있으면 컨테이너 여러 개를 생성할 수 있다.
- **컨테이너로 이미지를 만들 수 있다.**
    - 이미 만든 컨테이너를 컨테이너의 금형을 새로인 만들 수 있다.
    - **이미지로 컨테이너를 만들어 개조하고 개조한 컨테이너를 다시 이미지로 만들어 배포하면 다수의 서버를 만드는데 편리하다.**
- 도커 엔진 간에 이동이 가능하다.
    - 동일한 컨테이너를 여러 개 만들지 않고 다른 서버나 컴퓨터에 도커 엔진을 설치하고 새로운 도커 엔진에 이미지를 이용해 똑같은 컨테이너를 생성하면 편리하다.

### 도커 허브와 도커 이미지

- 컨테이너의 이미지를 밑바닥 부터 만들어 낼 일은 거의 없다.
- 이미지는 주로 도커 허브에서 구한다.
- 도커 허브는 공식적으로 운영되는 도커 레지스트리(도커 이미지를 배포하는 서비스)이다.
- 도커 허브에는 공개된 컨테이너 이미지가 모여 있다.
- 도커 허브에는 운영체제만 들어 있는 이미지부터, 여러 가지 소프트웨어가 함께 포함된 것 까지 다양한 이미지가 제공된다.
    - 직접 수정하고 싶다면 간단하 이미지
    - 편리하게 사용하고 싶다면 설정이 완료된 이미지 등 용도에 따라 원하는 것을 선택
        
        ![KakaoTalk_20220904_173005381.jpg](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/332685a5-786b-4721-bf56-241626e8642a/KakaoTalk_20220904_173005381.jpg)
        
- 소프트웨어마다 다양한 변종 이미지가 제공된다.
    - 리눅스 배포판
    - 배포판의 버전마다 운영체제만 들어간 컨테이너도 별도로 제공
        
        ![KakaoTalk_20220904_173005381_01.jpg](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/a5432605-d083-4c11-b205-0284aee09e17/KakaoTalk_20220904_173005381_01.jpg)
        
    - 여라 가지 소프트웨어가 들어가므로 조합의 가짓수는 셀 수 없이 많다.
        - 아파치, MySQL, nginx, sendmail 등 오픈소스 소프트웨어 대부분 이미 만들어진 이미지 제공 중
- 안전한 이미지를 고르는 방법
    - 공식 이미지를 사용
        - 선택도 쉽고 보안도 챙길 수 있다.
        - 특정 운영체제 및 버전으로 한정된 경우가 있으므로 주의
    - 커스텀 이미지를 직접 만들어서 사용
        - 필요한 최소한의 요소가 담긴 이미지에 필요한 소프트웨어를 추가로 설치해 커스텀 이미지를 만든다.
- 다양한 형태로 조합 가능한 컨테이너
    - 한 컨테이너에 한 프로그램
        - 도커를 사용할 때의 원칙 중 하나
        - 하나의 프로그램만 담긴 컨테이너를 사용한다는 의미, 보안 및 유지 관리 측면에서 유리하여 많이 쓰이는 정책
        - 예) 워드프레스를 사용하기 위해 아파치, MySQL(DBMS), 워드프레스 총 세 가지 소프트웨어가 필요하다.
            1. **이들을 각각 별도의 컨테이너로 구성할 수도 있고**
            2.  한 컨테이너에 모두 집어넣는 방법도 있다. (추천 x)
        
        ![한컨테이너.jpg](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/87a72b72-7102-43b7-954d-1c70c3e6c588/%ED%95%9C%EC%BB%A8%ED%85%8C%EC%9D%B4%EB%84%88.jpg)
        

## Section 03. 도커 컨테이너의 생애주기와 데이터 저장

### 도커 컨테이너는 ‘쓰고 버리는’ 일회용품

- 유지 보수 시 마다 일일이 업데이트는 번거롭다.
- 오래된 컨테이너를 버리고 새로운 이미지로부터 새로운 컨테이너를 만들어 갈아타는 방식 사용
- 컨테이너 하나를 업데이트하면서 사용하지 않고 업데이트된 소프트웨어가 들어있는 새로운 컨테이너 사용
- **컨테이너 생애주기**
    - 만들기 → 종료하기 → 폐기 → 만들기

### 데이터 저장

- 컨테이너 폐기 시 컨테이너 안의 편집했던 파일도 사라진다.
- 이를 방지하기 위해 **도커가 설치된 물리적 서버의 디스크를 마운트해 이 디스크에 데이터를 저장한다.**
    - 마운트는 디스크를 연결해 데이터를 기록할 수 있도록 한 상태
    - 도커 컨테이너가 물리적 컴퓨터의 디스크(HDD or SSD)를 연결해 데이터를 기록
    - 컨테이너가 폐기 되거나 도커 엔진 자체에 문제가 생기더라도 데이터는 그대로 보존
    - 데이터를 외부에 저장하면 다른 컨테이너와 데이터를 공유할 수도 있어서 매우 편리
    - 운영체제나 소프트웨어 부분은 컨테이너 형태로 만들엇다가 쓰고 버리는 것을 반복
    - 데이터는 다른 곳에 저장해두고 같은 것을 계속 사용, 설정 파일도 마찬가지
    

기술 습득 시에 책을 통해 공부하시나요 동영상 강의 같은 것을 찾아보시는 편이신가요? 기업에서 학습 컨텐츠도 많이 제공하나요?
